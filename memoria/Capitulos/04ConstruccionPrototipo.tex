%---------------------------------------------------------------------
%
%                          Capítulo 4
%
%---------------------------------------------------------------------

\chapter{Construcción de un prototipo}

%\begin{FraseCelebre}
%\begin{Frase}
%Surf it, scroll it, pause it, click it,\\
%cross it, crack it, switch - update it\\
%name it, rate it, tune it, print it,\\
%scan it, send it, fax - rename it\\
%touch it, bring it, pay it, watch it
%\end{Frase}
%\begin{Fuente}
%Thomas \& Guy-Manuel, Daft Punk
%\end{Fuente}
%\end{FraseCelebre}
%
\begin{resumen}
Para poder llevar a cabo este proyecto es necesario disponer de un dispositivo físico sobre el que se realizarán las pruebas de generación de energía y entorno vibrante.
Será necesario por tanto construir este dispositivo con los medios disponibles.
Como primer paso se estudiarán los materiales posibles para la fabricación y a continuación se procederá al montaje de diferentes prototipos buscando siempre la máxima funcionalidad.

\end{resumen}



%-------------------------------------------------------------------
\section{Estudio de materiales}
%-------------------------------------------------------------------
\label{cap4:sec:hardwareDescription}
%-------------------------------------------------------------------

La elección de los materiales de fabricación es crítica en la construcción de un dispositivo como este.
Las distintas partes del prototipo tienen que características especiales en cuando a su rigidez, dureza, resistencia, etc, y tienen que ser optimizadas teniendo en cuenta la limitación de materiales.

%-------------------------------------------------------------------
\subsection{Lámina}
%-------------------------------------------------------------------
\label{cap4:sub:lamina1}
%-------------------------------------------------------------------
La lámina es si cabe la parte mas critica del prototipo. Es la encargada de transmitir la vibración a los imanes para imprimirles movimiento.
La lámina tiene que que cumplir con ciertos requisitos. 
Debe tener un modulo de Young y por lo tanto una constante de amortiguamiento alta, y una resistencia a la fatiga muy alta también.

\textsl{Módulo de Young (módulo de elasticidad longitudinal):} Este parámetro mide la deformación que sufre un material elástico según la dirección en que se le aplica una fuerza.
En la curva tensión-deformación que todo material tiene, el modulo de Young se corresponde con la tangente del la zona lineal.

Los distintos materiales estudiados son:
\begin{itemize}
\item Acero inoxidable 301 y 302.
\item Berilio cobre.
\item Cobre.
\item Latón.
\end{itemize}

\begin{table}[!hbt]
\begin{center}
\begin{tabular}{||l | c | r||}
\hline
\hline
Material & Módulo de Young$[N/m^2]$ & Resistencia a la fatiga \\
\hline
Acero inoxidable & $2*10^{11}$ & alta\\
\hline
Berilio Cobre (BeCu) & $1.32*10^{11}$ & alta\\
\hline
Cobre & $1*10^{11}$ & media\\
\hline
Latón & $0.9*10^{11}$ & media\\
\hline
Grafeno & $10*10^{11}$ & alta\\ 
\hline

\end{tabular}
\caption{Distintos materiales y sus características.}
\label{tab:cap4:materiales}
\end{center}
\end{table}


De entre los materiales que se presentan en la tabla \ref{tab:cap4:materiales} el que mejor relación disponibilidad/módulo de Young presenta es el acero inoxidable. El segundo candidato es el BeCu. Muchas de las láminas de los generadores estudiados en el capitulo 2 están hechas de este material pero por dificultad para disponer de él, finalmente se decide construir el prototipo en torno a una lamina de acero inoxidable.


A la hora de buscar el material y tras estudiar distintas alternativas, los puntos de acceso a este material se reducen considerablemente dado las cantidades ínfimas que se necesitan. Como opciones que se han explorado están flejes de reloj (Cuerda de relojes de pared) o paletas de obra.

Tras comprar una de estas ultimas en una ferretería se halla que la aleación de acero inoxidable del que esta hecha es una de las aleaciones buscadas (AL.301) por sus características de flexibilidad y resistencia a la fatiga.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.6\textwidth]{Imagenes/imagenes/cap4/paleta}  
        \caption{Paleta.}
        \label{fig:cap4:paleta1}
\end{figure}

Por otro lado el grosor de este acero es de 0.5mm. En función de este y de los tamaños de las láminas que se obtengan de la paleta se puede conocer la frecuencia de resonancia del generador.


%-------------------------------------------------------------------
\subsection{Base}
%-------------------------------------------------------------------

El material de la base tiene que ser lo suficientemente rígido como para poder transmitir las vibraciones del entorno a la lamina absorbiendo las mínimas posibles.

Para esto en principio se dispone de metacrilato y \ac{PVC} en el \ac{LSI} aunque posteriormente se recurrirá a \ac{PLA} impreso en 3D en las impresoras 3D cedidas por BQ a la \ac{ETSIT}.

El \ac{PLA} es un termoplástico biodegradable derivado de vegetales como el maíz. Sus características son parecidas al \ac{PET} y se puede conseguir mas o menos rigidez mediante una impresión mas o menos densa.
Las posibilidades que ofrece la impresión 3D para prototipado rápido son incalculables. Se puede fabricar cualquier pieza en el momento, si bien se requieren ciertos conocimientos de diseño 3D.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.6\textwidth]{Imagenes/imagenes/cap4/PLA}  
        \caption{Molécula de PLA.}
        \label{fig:cap4:pla}
\end{figure}
Este termoplástico tiene una temperatura de fusión de 160º sin embargo su temperatura óptima de extrusión para impresión ronda los 200º.
Su densidad es de $1.2g/cm^3$ lo que lo convierte en un material mas ligero que el \ac{PVC} e igual al metacrilato. La principal ventaja de usar \ac{PLA} frente al \ac{PVC} o el metacrilato además de la facilidad para hacer piezas mas precisas, es la capacidad de variar la densidad interna de la pieza (cantidad de material empleado). De esta manera dos piezas de las mismas dimensiones de metacrilato y \ac{PLA}, pueden pesar distinto aunque la densidad del material sea la misma. Esto es útil a la hora de fabricar piezas de las que no se requiera grandes esfuerzos como se verá mas adelante.

%-------------------------------------------------------------------
\subsection{Bobina}
%-------------------------------------------------------------------

El material para la construcción de las bobinas es hilo de cobre esmaltado de diferentes grosores.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.6\textwidth]{Imagenes/imagenes/cap4/hilo-cobre}  
        \caption{Bobinas de hilo de cobre esmaltado.}
        \label{fig:cap4:hilo}
\end{figure}

La resistividad del cobre es de $1.71*10^{-2	} \Omega mm^{2}/m$. Conociendo este dato es inmediato hallar la resistencia equivalente de la bobina que servirá para adaptar la carga.

Este hilo de cobre se puede adquirir en cualquier tienda de electrónica con distintos grosores.
%-------------------------------------------------------------------
\subsection{Imanes permanentes}
%-------------------------------------------------------------------

Dado el pequeño tamaño del generador y la baja potencia de las vibraciones de las que se va a extraer la energía, se hace necesario maximizar el acoplo electromagnético como se ha visto en [poner formula de voltaje producido], y para ello, una de las medidas a tomar es maximizar el flujo magnético a través de la bobina [poner formula de acoplo electromagnético]. Actualmente los imanes que ofrecen estas características son los de NdFeB o más comúnmente conocidos como imanes de Neodimio \cite{iman2} \cite{iman1}.
Son imanes permanentes de tierras raras que están fabricados de una aleación de neodimio, hierro y boro que cristaliza en forma tetragonal.
$$Nd_{2}Fe_{14}B$$
Tienen unas grandes prestaciones, siendo en estos momentos, los imanes permanentes de mayor fuerza. Estos imanes se encuentran bañados en níquel para evitar su corrosión.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/imanes_neodimio}  
        \caption{Imanes de neodimio cubiertos de níquel.}
        \label{fig:cap4:imanes}
\end{figure}
%-------------------------------------------------------------------
\section{Materiales disponibles}
%-------------------------------------------------------------------
\label{cap4:sec:materialconst}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Lámina}
%-------------------------------------------------------------------
Las laminas para el generador se van a obtener a partir de la paleta vista en la sección \ref{cap4:sub:lamina1}. Este acero se va a mecanizar en diferentes tamaños que son 1cm, 1.5cm, 2cm y 2.5cm como se puede ver en la imagen \ref{fig:cap4:cortes}.

Una lamina de por ejemplo 2cm de ancho, 5cm de largo y 0.5mm de grosor tiene una frecuencia de resonancia de 160Hz, y si fuese de 10cm, su frecuencia seria de 40Hz.
Estas frecuencias están en el rango de trabajo del proyecto por lo tanto las laminas obtenidas son aptas para la construcción del prototipo.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.6\textwidth]{Imagenes/imagenes/cap4/cortes}  
        \caption{Diferentes láminas obtenidas.}
        \label{fig:cap4:cortes}
\end{figure}
\FloatBarrier

%-------------------------------------------------------------------
\subsubsection{Problemas y observaciones}
%-------------------------------------------------------------------

Las láminas han sido obtenidas mediante una cortadora de cizalla situada en el taller de la \ac{ETSIT}.
Este proceso de corte dobla ligeramente los bordes y produce rebabas, que pueden causar que la frecuencia de resonancia no sea pura, por lo que antes de montar cualquier lamina en el generador hay que limar los bordes.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.4\textwidth]{Imagenes/imagenes/cap4/lima_borde}  
        \caption{Proceso de limado de bordes.}
        \label{fig:cap4:limaborde}
\end{figure}
\FloatBarrier

%-------------------------------------------------------------------
\subsection{Bobina}
%-------------------------------------------------------------------


Para fabricar la bobina es necesario conocer sus dimensiones óptimas y como su construcción afecta a la producción de energía.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/bobinas}  
        \caption{Dimensiones de la bobina.}
        \label{fig:cap4:imanes}
\end{figure}

Siendo:
\\
$R_{i}=$ Radio interno.
$R_{o}=$ Radio externo.
$H_{c}=$ Ancho de la bobina.
\\
De \cite{beeby} se obtienen las siguientes ecuaciones que determinan los parámetros de la bobina:
\\
\\
Volumen ocupado por la bobina:
$$V_{T}= \pi (R_{o}^{2}-R_{i}^{2})h_{c}$$
Longitud del hilo:
$$L_{w}=\frac{4fV_{T}}{\pi w_{d}^{2}}$$
Resistencia de la bobina:
$$R_{c}=\frac{\rho L_{w}4}{\pi w_{d}^{2}}$$
Numero de espiras:
$$N=\frac{L_{w}}{R_{i}+\frac{(R_{o}-R_{i})}{2}}$$
Factor de llenado de la bobina:
$$f=\frac{A_{w}N}{A_{c}}$$



El resto de parámetros son:

\medskip
$A_{w}=$ Área del cable.

$A_{c}=$Área de un corte transversal de la bobina.

$\rho =$Resistividad del cobre.

$w_{d}=$Diámetro del hilo.
\medskip

Con estos parámetros se procede a construir varias bobinas. Sus características son:



\begin{table}[!hbt]
\begin{center}
\begin{tabular}{|l | c | c | c | c | r|}
\hline
\hline
Bobinas & $R_{i}$(cm) & $R_{o}$(cm) & $H_{c}$(cm) & $w_{d}$(mm) & $L_{w}$(m)\\
\hline
Bobina 1 & 0.5 & 1 & 0.9 & 0.5 & 5.4\\
\hline
Bobina 2 & 0.5 & 1 & 0.3 & 0.2 & 10.5\\
\hline
Bobina 3 & 0.3 & 1 & 0.3 & 0.2 & 12.7\\
\hline

\end{tabular}
\caption{Bobinas construidas.}
\label{tab:cap4:materiales}
\end{center}
\end{table}
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/bobinas2}  
        \caption{Bobinas construidas.}
        \label{fig:cap4:bobinaconstru}
\end{figure}
\FloatBarrier

%-------------------------------------------------------------------
\subsubsection{Núcleo}
%-------------------------------------------------------------------

Para los primeros prototipos el núcleo fue construido a partir de piezas planas de plástico que mediante un mecanizado a base de lija se les dio una forma circular. Para unirlas se usó un trozo de tubo de \ac{PVC} de 1cm de diámetro como se puede apreciar en la imagen.
Este plástico da la suficiente rigidez para poder formar la bobina y a la vez es lo suficiente fino para que no ocupe un volumen considerable respecto a lo que tiene que ser hilo de cobre.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/nucleos}  
        \caption{Núcleos de plástico.}
        \label{fig:cap4:Nucleos de plástico}
\end{figure}
\FloatBarrier

Cuando se tuvo acceso a las impresoras 3D de BQ el núcleo se imprimió en \ac{PLA} eliminando la parte de la construcción si se quería fabricar una nueva bobina.
%-------------------------------------------------------------------
\subsubsection{Arrollamiento o bobinado}
%-------------------------------------------------------------------
La longitud de hilo necesaria para construir la bobina se calcula a partir de los parámetros de la propia bobina, como pueden ser diámetro interno, externo, anchura del eje y diámetro del hilo empleado como se ha visto en la tabla \ref{fig:cap4:bobinaconstru}.

Por ello para la bobina 1 serían necesarios 5.4m de hilo con un grosor de 0.5mm.

Como primer método para bobinar, se construye un banco con un taladro y una varilla roscada en la cual se inserta la bobina. Se fija un extremo del hilo a la bobina, y a la mínima velocidad posible se enrolla el hilo intentando que vaya quedando uniforme capa a capa.
Con este método se construyen las tres primera bobinas.

Una vez construidas se les aplica una capa de pegamento para mantener las espiras externas fijas en su sitio.

Pero una bobina construida con este hilo presenta un problema y es que el hilo esmaltado no se puede soldar. Es necesario retirar la capa de esmalte de las puntas para que se fije el estaño.

Para retirar el esmalte se probó con varios métodos y al final una combinación de estos resultó la mejor opción.
Lo que se probó primero fue una serie de disolventes , papel de lija o quemar con el soldador.

Entre los disolventes utilizados se encontraban acetona, tolueno o alcohol. 
No se consiguió una disminución significativa de la capa de esmalte con ninguno de ellos.

El papel de lija aunque es una solución menos elegante, es mas inmediata y con paciencia y pericia se puede retirar la mayor parte de la capa de esmalte.
Tras usar la lija, el soldador retira el esmalte sobrante pudiendo de esta manera soldar los extremos del hilo.

%-------------------------------------------------------------------
\subsubsection{Problemas y observaciones}
%-------------------------------------------------------------------

La construcción de estas 3 bobinas reveló un punto débil. Una vez fijadas las espiras, los extremos del hilo quedan sueltos.
El hilo de diámetro tan pequeño es tan frágil que con el tiempo y el uso de la bobina se acaba partiendo, lo que provoca que haya que construir la bobina de nuevo. Para esto en un primer momento se pensó en fijar la bobina en un soporte fabricado con espuma de poliuretano y soldar los extremos a hilo de wirewrapping para que se dañasen lo mínimo posible los componentes internos.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/bobina_cuna}  
        \caption{Bobina protegida.}
        \label{fig:cap4:Bobina protegida}
\end{figure}
\FloatBarrier

Para el prototipo final se utilizó un conector fijo, sujeto a la base del generador como se verá mas adelante.
%-------------------------------------------------------------------
\subsection{Imanes}
%-------------------------------------------------------------------

Para la realización de este proyecto se han adquirido varios imanes de neodimio de reducido tamaño.
En concreto se dispone de:
\begin{table}[!hbt]
\begin{center}
\begin{tabular}{|l | c | c | c | r|}
\hline
\hline
Imanes & Lado1(mm) & Lado2(mm) & Grosor(mm) & Peso(g) \\
\hline
Imán 1 & 10 & 10 & 0.2 & 1.5\\
\hline
Imán 2 & 10 & 10 & 0.3 & 2.3\\
\hline
Imán 3 & 10 & 10 & 0.5 & 3.8\\
\hline
Imán 4 & 0.8 & 0.8 & 0.4 & 1.9\\
\hline
\end{tabular}
\caption{Imanes disponibles.}
\label{tab:cap4:materiales}
\end{center}
\end{table}

\FloatBarrier

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/imanes_neodimio2}  
        \caption{Imán de 10xmm10mmx0.3mm}
        \label{fig:cap4:imanes}
\end{figure}


Estos imanes van a ir montados sobre unos soportes, que hacen que intercambiarlos para las pruebas sea fácil como se puede ver en la figura \ref{fig:cap4:Soporteiman}. El material de estos soportes  es aluminio de 1mm de grosor. Este material es ligero y a la vez resistente ya que tiene que soportar las tensiones que producen estos imanes que a las distancias a las que van colocados pueden llegar a ser muy importantes. 
\begin{figure}[!h]
        \centering
        \subfloat[Diseño de los soportes.]{\label{fig:cap4:sopdis}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/soporte_imanes}} 
        \qquad
		\subfloat[Soportes reales.]{\label{fig:cap4:sopreal}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/soporte_imanes2}}
\caption{Soporte de los imanes.}
        \label{fig:cap4:Soporteiman}
\end{figure}
Los imanes son fijados a estos soportes con pegamento a base de cianocrilato (superglue), pegamento de gran resistencia que ha demostrado ser el mejor para conseguir una buena fijación. Aun así, si el soporte recibe un golpe fuerte (caída o un imán suelto es atraído y golpea) los imanes se pueden desprender, por lo que hay que manejar este montaje con cuidado.




%-------------------------------------------------------------------
\section{Calculo de la resistencia óptima de carga y elección de arquitectura.}
%-------------------------------------------------------------------
\label{cap4:sec:arquitectura}
%-------------------------------------------------------------------

\subsubsection{Resistencia óptima de carga}

Puesto que la bobina va a tener asociada una impedancia, para lograr una máxima transferencia de energía hace falta adaptarla a la carga que se coloque a la salida.
Para esto se ha seguido un procedimiento expuesto en \cite{beeby} y en \cite{arquitecturas1}.


Cuando el generador está limitado por los acoplos parásitos, la potencia máxima se puede hallar igualando el acoplo electromagnético al acoplo parásito y despejando la resistencia de carga:
$$ R_{l}=R_{c}+\frac{N^{2}(\frac{d\theta}{dx})^{2}}{D_{p}}$$
Donde $D_{p}$ es el acoplo parásito, N el número de espiras de la bobina, $R_{c}$ la resistencia de la bobina, $R_{l}$ la resistencia óptima de carga y $(d\theta /dx)$ el gradiente de flujo electromagnético.

Como se puede apreciar, la resistencia óptima de carga varía en función del acoplo magnético, por lo tanto para distintos tipos de arquitectura (posición relativa de los imanes respecto a la bobina), la resistencia óptima de carga va a variar, aunque la bobina empleada sea siempre la misma. Esto se va a estudiar a continuación.

Cuando el acoplo parásito es mucho mayor que el acoplo electromagnético, la resistencia óptima de carga es igual a la resistencia de la bobina.

Coeficientes de amortiguación
En el caso del generador electromagnético el coeficiente de amortiguamiento se puede escribir como
$$c_{e}=\frac{(NlB)^2}{R_{load}R_{coil}+jwL_{coil}}$$
l es la longitud lateral de la bobina (suponiéndola cuadrada). B es la densidad de flujo a través de la bobina.

Esta fórmula es solo una aproximación, válida si la bobina pasa de un campo intenso de flujo B, a una zona con flujo nulo. Se puede conseguir una fórmula más precisa mediante análisis numérico de elementos finitos pero para este proyecto este caso no se contempla.

Se puede ajustar $R_{load}$ para hacer coincidir $c_{e}$ y $c_{p}$ y por lo tanto como ya se ha visto, maximizar la potencia teniendo en cuenta las limitaciones de la bobina (resistividad, diámetro del cable y geometría). Según \cite{stephen} la resistencia óptima de carga puede ser obtenida según:
$$R_{load}=R_{coil}+\frac{(NlB)^2}{c_{p}}$$
Y por lo tanto la máxima potencia en este caso se puede ver como:
$$P_{loadMax}=\frac{mA^2}{16\zeta _{p}w_{n}}(1-\frac{R_{coil}}{R_{load}})$$

Este estudio es válido si a la salida se la bobina se conecta una carga resistiva.
En capítulos posteriores se estudiará este caso y otros en mayor profundidad.

\subsubsection{Elección de la arquitectura}

A la hora de construir un generador un factor importante a tener en cuenta es su arquitectura. En función de la posición de la bobina respecto a los imanes se obtendrán unas características u otras como puede ser la tensión generada, o la potencia generada.

Las posibles arquitecturas, obtenidas de \cite{arquitecturas1}, son las que se muestran en la figura \ref{fig:cap4:arqu}.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/posiblesarquitecturas}  
        \caption{Posibles arquitecturas}
        \label{fig:cap4:arqu}
\end{figure}
%\FloatBarrier

Cada arquitectura tiene una resistencia de carga óptima. En función de esta, se han obtenido los resultados mostrados en la figura \ref{fig:cap4:resultados}.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.7\textwidth]{Imagenes/imagenes/cap4/result}  
        \caption{Resultados de las diferentes arquitecturas}
        \label{fig:cap4:resultados}
\end{figure}
\FloatBarrier
\begin{enumerate}[label=(\alph*)]
\item Máxima tensión de salida.
\item Potencia a la máxima tension de salida.
\item Máxima potencia de salida.
\item Tensión a la máxima potencia de salida.
\end{enumerate}
  
Como se puede ver en la gráfica, la arquitectura II produce más tensión que el resto de arquitecturas para su resistencia óptima de carga y la arquitectura IV produce más potencia a la salida que el resto de arquitecturas para su resistencia óptima de carga.

A la vista de estos resultados, la arquitectura II y la IV son candidatas para la construcción del generador.

A continuación se muestran los distintos resultados que ofrecen estas dos arquitecturas a igualdad de condiciones de entorno.
\begin{figure}[!h]
        \centering
        \subfloat[Resultados de la arquitectura II.]{\label{fig:cap4:resII}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/resultII}} 
        \qquad
		\subfloat[Resultados de la arquitectura IV.]{\label{fig:cap4:resIV}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/resultIV}}
\caption{Comparativa de arquitecturas.}
        \label{fig:cap4:resArq}
\end{figure}

\FloatBarrier

\begin{enumerate}[label=(\alph*)]
\item Gradiente de flujo magnético a través de la bobina ($K=\frac{d\theta}{dx}$).
\item Resistencia óptima de carga.
\item Tensión a la salida.
\item Potencia a la salida.
\end{enumerate}

Con estos resultados, el prototipo que se construye sobre la arquitectura IV por diversos motivos.

La potencia maxima es mayor.
La resistencia optima de carga es menor.
Se obtienen mayores valores para una dimension de bobina menor.

Aunque este proyecto se va a desarrollar en condiciones diferentes a las de este estudio (\citep{arquitecturas1}), los resultados son aplicables.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/generador2}  
        \caption{Representación del generador con arquitectura IV}
        \label{fig:cap4:genimag}
\end{figure}

\FloatBarrier
%-------------------------------------------------------------------
\section{Fabricación de prototipos}
%-------------------------------------------------------------------
\label{cap4:sec:fabricacion}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Prototipo 1}
%-------------------------------------------------------------------

Para el primer prototipo se va a emplear \ac{PVC} tanto para la base como para el soporte.
Para la lámina se va a emplear un corte de 1cm de ancho. De esta manera se construye el primer prototipo:
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/proto1}  
        \caption{Primer prototipo}
        \label{fig:cap4:prot1}
\end{figure}



La base y el soporte se mecanizaron a mano con una sierra para metal.

La lamina se fijó al soporte mediante un tornillo pasante que también fijaba la base, de esta manera un solo tornillo sujetaba todo el conjunto.

Este prototipo no deja de ser mas que una mera prueba, fue construido para observar los efectos de las vibraciones sobre la lámina, y como se comporta esta con los imanes montados.
Así mismo sirvió para probar la potencia del banco de trabajo y hacerse una idea general de como se quería enfocar el diseño final. 

No se llegó a montar la bobina para producción de energía, aunque se diseñaron varios tipos de soporte para ella, uno de los cuales se puede apreciar en la imagen \ref{fig:cap4:prot1}.

Por otro lado también se construyó para probar los materiales, viendo que el \ac{PVC} no es un buen material puesto que es bastante pesado y absorbe gran cantidad de vibraciones, cosa poco conveniente porque el interés del proyecto es que se transmitan las máximas vibraciones a la lámina. Aun así si que se probó el acero inoxidable de la lamina como el material adecuado respondiendo bien a la frecuencia del entrono y alcanzando gran amplitud de vibración para su frecuencia de resonancia.

Respecto al comportamiento con los imanes, este prototipo sirvió para ver algo que en los modelos teóricos para el calculo de frecuencia de resonancia no se contempla y es el efecto del peso de los imanes.
No solo hay que elegir las dimensiones de la lámina en función del rango de frecuencias de resonancia deseado sino también en función del peso de los imanes que hacen que la lámina se curve.
Otro uso que se le dio a este prototipo fue para el diseño del sistema de anclaje al banco de trabajo.

Las dimensiones del generador de la imagen son 13cm de largo, 4cm de alto y 2cm de ancho.
La lámina es de 1cm de ancho y 12cm de largo.
%-------------------------------------------------------------------
\subsection{Prototipo 2}
%-------------------------------------------------------------------
\label{cap4:sec:prot2}
%-------------------------------------------------------------------

Una vez que se obtuvieron todos los resultados del prototipo anterior era hora de construir otro con las mejoras propuestas.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/proto2}  
        \caption{Segundo prototipo}
        \label{fig:cap4:prot2}
\end{figure}
Como primera decisión se cambió el material de la base. Se empleó metacrilato que proporciona mayor rigidez que el \ac{PVC} (absorbe menos vibraciones del entorno) y menor densidad (menor peso por volumen).
En concreto con este nuevo material, el grosor de la base se redujo a la mitad (0.5cm) y también fue mecanizada a mano.

El ancho de la lámina se aumentó a 1,5cm que permite soportar el peso de los imanes y del soporte de estos, una mejora añadida en este punto.

Este soporte es consecuencia del diseño de la arquitectura IV. Se trata de un soporte en $"U"$ invertida que sostiene los imanes para que se desplacen en los laterales de la bobina.

La fabricación de esta pieza se realizó mediante doblaje a mano con un torno, y posteriormente lijando las imperfecciones de los bordes para conseguir equilibrarla.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/sop_iman}  
        \caption{Soporte en U para los imanes}
        \label{fig:cap4:prot2}
\end{figure}
\FloatBarrier

La inclusión de este soporte produjo un problema, y es que cuando el generador se sintonizaba, la amplitud de la oscilación era tan grande que los extremos del soporte golpeaban en la base.
Para evitar esto en un primer momento se mecanizó la base para dejar paso libre al soporte.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.4\textwidth]{Imagenes/imagenes/cap4/diente_base}  
        \caption{Detalle del hueco para el soporte de imanes en la base}
        \label{fig:cap4:hueco}
\end{figure}
\FloatBarrier
Por otro lado este montaje permitió estudiar diferentes sistemas de anclaje de la lámina a la base. Finalmente se implementó un clip de aluminio, que mediante presión, no solo fijaba la lamina sino que además evitaba que esta se desplazase lateralmente descentrado los imanes.
\begin{figure}[!h]
        \centering
		\includegraphics[width=0.4\textwidth]{Imagenes/imagenes/cap4/clip_lamina}  
        \caption{Detalle del clip de fijación}
        \label{fig:cap4:clip}
\end{figure}
\FloatBarrier
Con todo este prototipo montado con sus mejoras, se pasó a realizar las primeras pruebas de funcionamiento de todo el conjunto.

Se probaron las primeras bobinas viéndose que se producía energía, en concreto una señal de 200mVpp sobre una impedancia de 8$\Omega$ con una bobina de 7$\Omega$ lo que significa 625$\mu W$ de potencia. 
Como punto negativo, la señal producida no era sinusoidal ni parecida y estaba atenuada. El problema estaba generado por el soporte de los imanes. Cuando entraba en resonancia, ya no golpeaba contra la base, pero sí golpeaba contra la bobina, y este choque, no amortiguado, producía picos en la señal de salida que le restaban amplitud puesto que el flujo magnético de los imanes no barría toda la bobina. 

La solución a este problema requería un cambio en el diseño del generador puesto que la pieza que sustituiría a este soporte no podía ser construida ni implementada con ese prototipo, por lo que este se dejó a un lado para construir el siguiente.
%-------------------------------------------------------------------
\subsection{Prototipo 3}
%-------------------------------------------------------------------
Este prototipo surgió de la necesidad de cambiar el diseño del prototipo 2 para la sujeción de los imanes.

Por otro lado para cuando se planteó su construcción, BQ puso a disposición sus impresoras 3D por lo que el nuevo diseño se imprimió completamente en 3D. Este nuevo método permitía además diseñar la pieza necesaria para que el soporte de lo imanes no golpease la bobina.

Gracias a la potencia de la impresora 3D y el diseño por ordenador se pueden fabricar piezas mucho mas precisas que si se hiciesen a mano como los dos primeros prototipos.
Cabe además destacar que piezas de este tamaño son relativamente rápidas de imprimir y si por alguna causa la pieza no es valida se puede imprimir otra de inmediato, lo que permite ajustar unas a otras con gran precisión.

En la imagen \ref{fig:cap4:base3D} se ve la base del generador que anteriormente fue construida en \ac{PVC} y metacrilato, impresa en 3D con \ac{PLA}.

\begin{figure}[!h]
        \centering
		\includegraphics[width=0.4\textwidth]{Imagenes/imagenes/cap4/base_3D}  
        \caption{Base impresa en 3D}
        \label{fig:cap4:base3D}
\end{figure}
La cuna para insertar la bobina fue añadida a la base para facilitar el montaje posterior del sistema completo, así como el soporte de la lamina. De esta manera se reduce al mínimo el numero de piezas del generador.
\FloatBarrier



Respecto a la pieza para el soporte de imanes se diseñaron y probaron dos distintas.

La primera pieza se dividió en tres módulos, que se montaban, fijando la lámina entremedias y de esta manera daba solidez al conjunto como se ve en la figura \ref{fig:cap4:Soporteiman1}.
\begin{figure}[!h]
        \centering
        \subfloat[Soporte en piezas.]{\label{fig:cap4:sopdis}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/sop_iman3D1}} 
        \qquad
		\subfloat[Soporte montado en el generador.]{\label{fig:cap4:sopreal}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/sop_iman3D1_all}}
\caption{Primera pieza para soportar imanes.}
        \label{fig:cap4:Soporteiman1}
\end{figure}

Los problemas de esta pieza fueron dos.
Era difícil de montar y difícil de mantener unida. Aunque la idea es buena, las impresión 3D no es perfecta y las piezas no son exactamente iguales al modelo 3D por lo que para esta en concreto, que encajasen perfectamente unas partes con otras era prácticamente imposible, lo que llevó a replantear la pieza entera.

Como requisitos para el nuevo soporte se fijó que no tuviese distintas partes que encajasen unas con otras construyéndose entero de una sola pieza como se ve en la imagen \ref{fig:cap4:Soporteiman2}.
\begin{figure}[!h]
        \centering
        \subfloat[Soporte.]{\label{fig:cap4:sopdis}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/sop_iman3D2}} 
        \qquad
		\subfloat[Soporte montado en el generador.]{\label{fig:cap4:sopreal}\includegraphics[width=0.5\textwidth]{Imagenes/imagenes/cap4/sop_iman3D2_all}}
\caption{Segunda pieza para soportar imanes.}
        \label{fig:cap4:Soporteiman2}
\end{figure}
\\
Aunque el nuevo diseño es mas simple, con el tiempo se ha demostrado que es indudablemente mejor.
\FloatBarrier
%-------------------------------------------------------------------
\subsection{Prototipo final}
%-------------------------------------------------------------------

En esta sección se va a mostrar el prototipo final del generador. Muchos de sus componentes aun no han sido explicados, pero serán referenciados a sus respectivos capítulos cuando aparezcan para una mejor comprensión del conjunto.

En el prototipo 3 se vio que ya estaba impreso en 3D y que era funcional. Pero el objetivo de este proyecto es que pueda ser sintonizado. [REFERENCIAR AL CAPITULO 6, SINTONIZACIÓN]
%-------------------------------------------------------------------
\section{Serial Communication Board - rs232SHIELD}
%-------------------------------------------------------------------
\label{cap4:sec:rs232shield}
%-------------------------------------------------------------------
\figura{Vectorial/Capitulo4/rs2322develop}{width=.6\textwidth}{fig:cap4:rs232hw}
{rs232SHIELD detail over global hardware modules to develop.}

%-------------------------------------------------------------------
\subsection{Description}
%-------------------------------------------------------------------
This extension sets serial communication between the \ac{MCU} and a PC over a RS232 protocol. It supposes an alternative wired serial communication way for the included \ac{USB} option, which progressively has become more popular. Including RS232 serial communication produces an increase of the cost, size, and power consumption. For this reason, it was chosen not to embed this module over the \ac{CNGD}, but rather create a expansion module. 

This technology could be useful for old machines, low-resources researches, or for debugging purposes during the platform development until the \ac{USB} communication is fully operative. This communication way posses a simpler operation mode than \ac{USB}.

\ac{UART} 6 is used, accessible  at the headers and not requiring hardware flow control. Since RS232 standard operates on voltage values from -12V to 12V, a level conversion is needed. This conversion takes place at the MAX3232 \cite{max3232} transceiver. Figure \ref{fig:cap4:max3232} shows the MAX3232 scheme. \ac{TX} \ac{UART} signal is accessed at header pin 37, \ac{RX} is at 20. Since the communication does not require for hardware flow control\footnote{Hardware flow control allows to control the serial data flow by using extra signals apart from the data signals.}, two pins are enough to set proper communication.

\figuraEx{Bitmap/Capitulo4/max3232}{width=.5\textwidth}{fig:cap4:max3232}%
{MAX3232 basic scheme, obtained from \cite{max3232}.}{MAX3232 basic scheme.}

%-------------------------------------------------------------------
\subsection{Schematics}
%-------------------------------------------------------------------
A schematic view of the rs232SHIELD is shown at Figure \ref{fig:cap4:rs232shieldschematic} on Appendix \ref{ap1:schematics}.

%-------------------------------------------------------------------
\section{Batteries charger - chargerSHIELD}
%-------------------------------------------------------------------
\label{cap4:sec:chargerShield}
%-------------------------------------------------------------------
\figura{Vectorial/Capitulo4/charger2develop}{width=.6\textwidth}{fig:cap4:chargerhw}
{chargerSHIELD detail over global hardware modules to develop.}
%-------------------------------------------------------------------
\subsection{Description}
%-------------------------------------------------------------------
\ac{NIMH} batteries are amongst the hardest batteries to charge. Whereas with lithium ion and lead acid batteries you can control overcharge by just setting a maximum charge voltage, nickel based batteries do not have a ``float charge'' voltage. So the charging is based on forcing current through the battery. What is usually called as linear charger.

Charge rate, usually denoted as C, signifies a charge or discharge rate equal to the capacity of a battery in one hour. For a 1 Ah battery, C is 1A. A charge rate of C/2 (0.5A), would need two hours, whereas a charge rate of 2C (2A), if supported, would need 30 minutes to fully charge the battery. \ac{NIMH} batteries are sensitive to damage on overcharge when the charge rate is over C/10.

Previous statements assumes that the battery has a 100\% coulometric charging efficiency\footnote{Part of the electrical charge stored in a battery by charging that is recoverable during discharging. Usually expressed as a percentage.}. The coulometric charging efficiency of \ac{NIMH} batteries is typically 60\%. However, the faster you charge, the worse this parameter gets.

Hence, for our 2.9 Ah batteries, considering a charge rate C/10. A charge current of 290 mA could be accepted, taking from 10 to 15 hours to fully charge the batteries. However, let set the charge current around 200 mA as precautionary measure. This way, quality of the batteries is preserved and the charger is suitable for less capacity batteries.

We also want our charger to automatically switch-off once the batteries are full. We will keep sensed the voltage at the batteries poles to detect the end-of-charge moment. As initial approximation, we could establish the end-of-charge when voltage at the batteries is around 10\% higher than their nominal value, 3.6 V. The sensed voltage will be compared with a reference voltage at the input of an LM311 \cite{lm311} comparator. Reference voltage is obtained by a simple voltage divider.

The LM311 is a single high-speed voltage comparator. These devices are designed to operate from a wide range of power-supply voltages, including
$\pm$ 15 V supplies for operational amplifiers and 5 V supplies for logic systems. The output levels are compatible with most \ac{TTL} and \ac{MOS} circuits. These comparators are capable of driving lamps or relays and switching voltages up to 50 V at 50 mA. Figure \ref{fig:cap4:ampconf} gives the recommended configuration provided by the manufacturer.

\figuraEx{Bitmap/Capitulo4/ampconf}{width=.5\textwidth}{fig:cap4:ampconf}{Collector output LM311 configuration, obtained from \cite{lm311}.}{Collector output LM311 configuration.}

To set a fixed current through the batteries, an LM317 \cite{lm317} voltage regulator is used. This is an adjustable 3-terminal positive-voltage regulator designed to supply up to 1.5 A of load current with an output voltage adjustable over a 1.2 V to 37 V range. It employs internal current limiting and thermal shutdown. Figure \ref{fig:cap4:lm317conf} illustrates the configuration required for the LM317. The formula below describes the relation among components and $V_{out}$.

\figuraEx{Bitmap/Capitulo4/lm317conf}{width=.6\textwidth}{fig:cap4:lm317conf}{Configuration scheme for the LM317 provided by the manufacturer, obtained from \cite{lm317}.}{Configuration scheme for the LM317 provided by the manufacturer.}

\[
V_{out} = 1.25 V(1+ \frac{R_{2}}{R_{1}}) + I_{Adj}R_{2}
\]

This regulator is configured to a 1.25 V output by choosing an R2 of 0 $\Omega$. Then a fix resistor between its output and ground will limit the output current and therefore, the input current. This fixed current will flow through the batteries during the charge. In addition, the drain of an IRF5802 \cite{irf5801} nMOSFET power transistor is placed at the regulator output. This means that the operation mode of the transistor affects the flowing current. If the transistor is under ohmic or saturation modes, current flows. The current does not flow if the transistor is cutoff.

IRF5802 presents a maximum drain-source on-resistance $R_{DS(on)}$ of 2.2 $\Omega$. Gate to source voltage $V_{GS}$ can vary from -30 V to +30 V, and gate threshold voltage $V_{GS(th)}$ is around 4 V. Maximum drain current $I_{D}$ goes up to 600 mA.

The previously mentioned LM311 output controls the gate of the transistor. It switches the transistor operation modes, from ohmic to cutoff, when LM311 output is set to high or low, respectively. And the output of this operational amplifier, in turn, relies on the sensed voltage at the batteries.

A green \ac{LED} driven by the comparator output, turns illuminated when this output drops enough to make current flows through the \ac{LED}. This way, the \ac{LED} indicates when the batteries voltage is over the reference voltage. A precautionary diode preserves the batteries from being reversely charged. 

The whole system was simulated on Alitum Designer and simulation traces can be observed later at this same section.

%-------------------------------------------------------------------
\subsection{Schematics}
%-------------------------------------------------------------------
A schematic of charger232SHIELD can be seen at Figure \ref{fig:cap4:chargershematic} on Appendix \ref{ap1:schematics}.

%-------------------------------------------------------------------
\subsection{Simulation}
%-------------------------------------------------------------------
Simulation at Altium Designer showed different behaviors facing different voltage at the batteries. It was needed to simulate models for LM311 operational amplifier and IRF5801 nMOSFET transistor. LM317AMDT was emulated composing simpler components. Figure \ref{fig:cap4:simulation1} illustrates the output voltage at the LM311 comparator depending on the voltage at the battery. Figure \ref{fig:cap4:simulation2} directly relates current flow over the battery with the voltage it posses. Graphics show the right behavior, changing properly the desired voltage and current values at certain battery charge.

\begin{figure}[h]
\centering
   
\subfloat[Output voltage at the comparator depending on the present voltage at the battery.]{\label{fig:cap4:simulation1}\includegraphics[width=\textwidth]{Imagenes/Bitmap/Capitulo4/simulation1}}  

\subfloat[Current flowing through the battery depending on the its voltage.]{\label{fig:cap4:simulation2}\includegraphics[width=\textwidth]{Imagenes/Bitmap/Capitulo4/simulation2}}
       
\caption{chargerSHIELD simulation results.}
\label{fig:cap4:simulation}
\end{figure}

%-------------------------------------------------------------------
\section{Tools}
%-------------------------------------------------------------------
\label{cap4:sec:tools}
%-------------------------------------------------------------------

%-------------------------------------------------------------------
\subsection{Altium Designer}
%-------------------------------------------------------------------
\label{cap4:sub:altiumDesigner}
%-------------------------------------------------------------------

For the designing task, an \ac{EDA}\footnote{Electronic design automation is a category of software tools for designing electronic systems such as printed circuit boards and integrated circuits.} software called Altium Designer will be used. Altium Designer is a software package for printed circuit board, FPGA, embedded software design, and associated library and release management automation. It is developed and marketed by Altium Limited of Australia, and is commonly used by researchers at \ac{LSI}. All of the \ac{CNGD} design process is carried through Altium Designer (on its Version 10). 

%\figura{Bitmap/Capitulo4/altium}{width=.3\textwidth}{fig:cap4:altium}%
%{Altium Designer logo} ******************** POR AQUI

Despite the amount of functions offered by Altium Designer, the two main options needed for this project are schematic capture, for circuit edition, and \ac{PCB} design, for subsequent layout deployment.

Options provided by the schematic capture module, required for the design task, includes:

\begin{itemize}
	\item \emph{Component library management}. Useful to create own components facing the logic design.
	\item \emph{\ac{SPICE} mixed-signal circuit simulation}. In order to simulate any functionality. Specially useful in analog modules 			design.
      	\item \emph{Netlist export}. This way, it is possible to export our designs easily to process under other softwares.
     	\item \emph{Reporting and \ac{BoM} facilities}. For simple management purposes.
	\item \emph{Multi-channel, hierarchical schematics and design re-use}. Facilitating the design task.
\end{itemize}

On the other hand, required options from the \ac{PCB} design module are:
\begin{itemize}
	\item \emph{Component footprint library management}. Equally useful to manage new components and embed them into our \ac{PCB} designs.
   	\item \emph{Component placement}. In order to freely design our own layouts.
   	\item \emph{Manual trace routing, with support for multi-trace routing}. Enabling and facilitating the layout design.
   	\item \emph{Interactive 3D editing of the board and MCAD export to STEP}. To obtain more realistic views and complete idea of our 			implementations on advance to their manufacturing.
   	\item \emph{Manufacturing files generation with support for Gerber formats}. Essential for manufacturing process.
\end{itemize}

%-------------------------------------------------------------------
\section{Components Library: cngd lib}
%-------------------------------------------------------------------
\label{cap4:sec:cngdlib}
%-------------------------------------------------------------------
For the accomplishment of the full design of the platform over Altium Designer, a component library with all the required but not found component models was set throughout the design process.

As it was said, the library includes models from all those components needed but not found as well as modifications of existing models in order to suit the design criteria. Every contained model embeds schematic, footprint and 3D model. 3D models are useful for 3D rendering and  checking proper hardware deployment. Electric models of components are not generally included.

Library is available at the mentioned repository that hosts the hardware design files. All the content included into the library is ready to be used under Altium Designer. Any use of the library is free. 

\begin{figure}[h]
\centering

\subfloat[cNGD logo footprint.]{\label{fig:cap4:cognitivefoot}\includegraphics[width=0.4\textwidth]{Imagenes/Vectorial/Capitulo4/cngdfoot}}%
\qquad
\subfloat[LSI logo footprint.]{\label{fig:cap4:lsifoot}\includegraphics[width=0.2\textwidth]{Imagenes/Vectorial/Capitulo4/lsifoot}}%
\qquad
\subfloat[SOT23-5 package footprint.]{\label{fig:cap4:sot235}\includegraphics[width=0.2\textwidth]{Imagenes/Bitmap/Capitulo4/sot235}}%

\caption{Specially designed footprints for the platform.}
\label{fig:cap5:footprints}

\end{figure}


% Variable local para emacs, para  que encuentre el fichero maestro de
% compilación y funcionen mejor algunas teclas rápidas de AucTeX
%%%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Tesis.tex"
%%% End:
